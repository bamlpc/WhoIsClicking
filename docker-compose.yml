version: '3.7'

services:

  frontend:
    build:
      context: ./frontend/home-ui
    container_name: home-ui
    restart: on-failure
    depends_on:
      - ngin
    stdin_open: true
    tty: true
    ports:
      - '3000:3000'
    networks:
      wic_frontend:
        aliases: 
          - home-ui_ip

  links-api:
    build:
      context: ./backend/links-api
    restart: on-failure
    depends_on:
      mongo-db:
        condition: service_healthy
    container_name: links-api
    init: true
    environment:
      - LINKS_URL=${LINKS_URL}
      - DB_NAME=${DB_NAME}
      - QR_URL=${QR_URL}
      - MONGODB_URL=${MONGODB_URL}
      - MONGODB_USER=${MONGODB_USER}
      - MONGODB_PASS=${MONGODB_PASS}
      - BACKEND_VERSION=${BACKEND_VERSION}
    networks:
      wic_backend:
        aliases: 
          - links-api_ip
  qr-api:
    build:
      context: ./backend/qr-api
    restart: on-failure
    depends_on:
      - links-api
    container_name: nft
    networks:
      wic_backend:
        aliases: 
          - qr-api_ip

  mongo-db:
    build:
      context: ./infra/mongo-db
    restart: always
    container_name: mongo-db
    environment:
      MONGO_INITDB_ROOT_USERNAME: $MONGO_ROOT_USER
      MONGO_INITDB_ROOT_PASSWORD: $MONGO_ROOT_PASS
      MONGO_INITDB_DATABASE: $DB_NAME
      MONGO_INITDB_USERNAME: $MONGODB_USER
      MONGO_INITDB_PASSWORD: $MONGODB_PASS
    networks:
      wic_backend:
        aliases: 
          - mongo-db_ip


  nginx:
    build: 
      context: ./infra/nginx
    restart: always
    container_name: nginx
    tty: true
    depends_on:
      - links-api
    networks:
      wic_backend:
        aliases:
          - nginx_ip
      wic_frontend:
        aliases:
          - nginx_ip

volumes: {}

networks:
  wic_backend:
    name: wic_net
    driver: bridge
    ipam:               #ip address management
      driver: default
  wic_frontend:
      name: wic_frontend
      driver: bridge
      ipam:               #ip address management
        driver: default